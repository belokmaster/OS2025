#!/bin/bash
# 9_4.sh - Сравнение возможностей исполнения операций при изменении прав доступа к файлу и каталогу.
# Создаем каталог и исполняемый файл, затем варьируем права для демонстрации влияния на выполнение операций.

TEST_DIR="access_test_dir"
TEST_FILE="$TEST_DIR/test_script.sh"

echo "Создаем каталог $TEST_DIR..."
mkdir -p "$TEST_DIR"

echo "Создаем тестовый исполняемый файл $TEST_FILE..."
echo "#!/bin/bash" > "$TEST_FILE"
echo "echo 'Исполнение тестового скрипта...'" >> "$TEST_FILE"

# Делаем файл исполняемым
chmod +x "$TEST_FILE"

echo -e "\nНачальные права доступа:"
echo "Каталог:"
ls -ld "$TEST_DIR"
echo "Файл:"
ls -l "$TEST_FILE"

echo -e "\nОперации, которые можно выполнить:"
echo "1. Исполнение скрипта: $TEST_FILE"
echo "2. Чтение содержимого скрипта: cat $TEST_FILE"

echo -e "\nИзменяем права доступа к каталогу (убираем права на чтение и исполнение):"
chmod 300 "$TEST_DIR"
echo "Новые права каталога:"
ls -ld "$TEST_DIR"

echo -e "\nПопытка исполнения скрипта из каталога с ограниченными правами:"
"$TEST_FILE" 2>/dev/null || echo "Скрипт не может быть выполнен из-за ограниченных прав на каталог."

echo -e "\nВосстанавливаем права каталога (chmod 755) и изменяем права файла (chmod 600):"
chmod 755 "$TEST_DIR"
chmod 600 "$TEST_FILE"
echo "Новые права каталога:"
ls -ld "$TEST_DIR"
echo "Новые права файла:"
ls -l "$TEST_FILE"

echo -e "\nПопытка исполнения скрипта с ограниченными правами на файл:"
"$TEST_FILE" 2>/dev/null || echo "Скрипт не может быть выполнен из-за ограниченных прав на файл."

echo -e "\nВосстанавливаем права файла для исполнения (chmod 755):"
chmod 755 "$TEST_FILE"
echo "Права файла:"
ls -l "$TEST_FILE"
echo "Исполнение скрипта:"
"$TEST_FILE"
